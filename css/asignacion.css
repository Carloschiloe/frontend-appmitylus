/* ==============================
   ASIGNACIÓN – Estilo alineado a GLOBAL (compacto & moderno)
   Scoped bajo .asig
============================== */

:root{
  /* Colores base */
  --ok:#2e7d32;
  --muted:#6b7280;
  --bar-req:#cfd8dc;
  --bar-asg:#7ec8e7;
  --bar-proc:#66bb6a;
  --bar-bg:#eef3f2;

  /* Colores tarjetas */
  --mock-border:#4caf50;
  --mock-real:#66bb6a;
  --mock-real-bg:#e9f2e9;
  --mock-asg:#7ec8e7;
}

/* ===== Toolbar / Leyenda ===== */
.asig .toolbar{display:flex;align-items:center;justify-content:space-between;margin:8px 0 10px}
.asig .toolbar .left{display:flex;gap:8px;align-items:center}
.asig select,.asig button,.asig input[type=number],.asig input[type=text]{
  background:#fff;color:var(--txt);border:1px solid var(--border);border-radius:8px;
  padding:6px 10px;font-size:.9rem
}
.asig button{background:var(--primary);color:#fff;border:none}
.asig button:hover{background:#013e34;box-shadow:var(--shadow)}
.asig .legend{display:flex;gap:12px;align-items:center;color:var(--txt-soft);font-size:.85rem}
.asig .bullet{width:10px;height:10px;border-radius:3px;display:inline-block}
.asig .b-req{background:var(--bar-req)} .asig .b-asg{background:var(--bar-asg)} .asig .b-proc{background:var(--bar-proc)}

/* ===== Layout ===== */
.asig .wrap{width:100%;max-width:none;margin:0;padding:0 10px}
.asig #cards{width:100% !important;display:block}
html,body{overflow-x:hidden}

/* ===== Grid: 12 por fila ===== */
.asig .grid{
  width:100%;
  display:grid;
  grid-template-columns:repeat(12, 1fr);
  gap:10px;
  align-items:start;
}

@media (max-width:1400px){ .asig .grid{ grid-template-columns:repeat(10,1fr);} }
@media (max-width:1200px){ .asig .grid{ grid-template-columns:repeat(8, 1fr);} }
@media (max-width:992px){  .asig .grid{ grid-template-columns:repeat(6, 1fr);} }
@media (max-width:768px){  .asig .grid{ grid-template-columns:repeat(4, 1fr);} }
@media (max-width:560px){  .asig .grid{ grid-template-columns:repeat(2, 1fr);} }
@media (max-width:380px){  .asig .grid{ grid-template-columns:1fr;} }

/* ===== Card base ===== */
.asig .card{background:transparent;border:none;border-radius:0;box-shadow:none;padding:0;cursor:pointer;position:relative}
.asig .card.lock{opacity:.45;pointer-events:none}

/* ===== Tarjeta MOCK (moderna, sin doble borde) ===== */
.asig .card--mock{
  padding:10px;
  border:1px solid var(--mock-border);
  border-radius:12px;
  background:#fff;
  font-family:inherit;
  transition:.2s ease all;
}
.asig .card--mock:hover{box-shadow:0 3px 8px rgba(0,0,0,.12);transform:translateY(-2px)}

/* Pastilla MES */
.asig .card--mock .month-pill{
  background:var(--mock-border);
  color:#fff;
  border-radius:6px;
  font-weight:600;
  text-align:center;
  padding:3px 5px;
  font-size:.65rem;
  margin-bottom:6px;
  letter-spacing:.3px;
}

/* Contenido principal */
.asig .card--mock .tons-title{
  text-align:center;
  font-weight:500;
  font-size:.65rem;
  color:#555;
  margin-bottom:2px;
}
.asig .card--mock .tons-value{
  text-align:center;
  font-weight:700;
  font-size:.95rem;
  line-height:1.1;
  margin:2px 0 4px;
  color:#111;
}

/* Filas de barras */
.asig .rowbar{
  display:grid;
  grid-template-columns:52px 1fr 28px;
  align-items:center;
  gap:4px;
  margin:3px 0;
}
.asig .rowbar .lbl{
  color:#555;
  font-weight:500;
  font-size:.6rem;
}
.asig .rowbar .pct{
  text-align:right;
  font-weight:600;
  color:#222;
  font-size:.6rem;
}

/* Barra */
.asig .barwrap{
  position:relative;height:5px;border-radius:3px;
  background:var(--mock-real-bg);overflow:hidden
}
.asig .barwrap .fill-real{position:absolute;left:0;top:0;bottom:0;width:0;background:var(--mock-real)}
.asig .barwrap .fill-asg {position:absolute;left:0;top:0;bottom:0;width:0;background:var(--mock-asg)}
.asig .n-left,.asig .n-right{
  position:absolute;top:-10px;font-size:.5rem;color:#666;font-weight:500
}
.asig .n-left{left:2px}
.asig .n-right{right:2px}

/* ===== Panel Chart ===== */
.asig .panel-chart{margin-top:14px;padding:10px;border:1px solid var(--border);border-radius:10px;background:var(--bg-soft);box-shadow:var(--shadow)}
.asig .panel-chart h3{margin:4px 6px 8px;font-size:.9rem;color:var(--primary)}

/* ===== Drawer (proveedores) ===== */
.drawer{
  position:fixed;top:78px;right:14px;width:420px;max-width:92vw;background:#fff;
  border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);display:none;z-index:10400
}
.drawer header{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid var(--border);font-weight:700;color:var(--primary);font-size:.95rem}
.drawer .x{background:#fff;border:1px solid var(--border);border-radius:8px;padding:2px 8px;cursor:pointer}
.drawer .x:hover{filter:brightness(.96)}
.drawer .body{max-height:58vh;overflow:auto;padding:8px 12px}
.drawer table{width:100%;border-collapse:collapse;font-size:.9rem}
.drawer th,.drawer td{padding:8px;border-bottom:1px solid #eef1f3;text-align:left}
.drawer th{color:#0f1e1d;font-size:.86rem;font-weight:700;background:#f7faf9}

/* ===== Modales ===== */
.asig-mask{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;z-index:10500}
.asig-modal{
  position:fixed;left:0;right:0;top:6vh;margin:0 auto;width:92%;max-width:760px;max-height:88vh;background:#fff;
  border:1px solid var(--border);border-radius:12px;box-shadow:0 18px 60px rgba(0,0,0,.25);display:none;z-index:10600;overflow:hidden
}
.asig-modal--sm{max-width:560px}
.asig-modal header{padding:10px 14px;font-weight:700;border-bottom:1px solid var(--border);color:var(--primary)}
.asig-modal .content{padding:12px 14px;max-height:calc(88vh - 110px);overflow:auto}
.asig-modal .actions{display:flex;gap:8px;justify-content:flex-end;padding:8px 14px;border-top:1px solid var(--border);background:#fff;position:sticky;bottom:0}

/* ===== FAB ===== */
.fab{
  position:fixed;right:18px;bottom:18px;background:var(--primary);color:#fff;border:0;border-radius:999px;
  padding:10px 12px;font-weight:700;box-shadow:var(--shadow);cursor:pointer;z-index:10300;font-size:.85rem
}
.fab:hover{background:#013e34}

/* ===== Responsive refinamientos ===== */
@media (max-width:640px){
  .drawer{right:10px;width:92vw;top:auto;bottom:86px;max-height:58vh;border-radius:12px}
  .drawer .body{max-height:calc(58vh - 56px)}
  .fab{right:14px;bottom:14px;padding:12px 14px}
}
/* ===== Tarjeta CONSOLIDADO AÑO ===== */
.asig .card--summary{
  background: linear-gradient(180deg,#ffffff 0%, #f6fff7 100%);
  border:1px solid var(--mock-border);
  border-radius:10px;
  padding:8px;
}
.asig .card--summary .month-pill{
  background:#e8f7ea;
  border:1px solid var(--mock-border);
  color:#1b5e20;
  border-radius:8px;
  padding:4px 6px;
  text-align:center;
  font-weight:700;
  font-size:.72rem;
  margin-bottom:6px;
}
.asig .card--summary .tons-title{ text-align:center; font-size:.7rem; color:#205a22; font-weight:700; }
.asig .card--summary .tons-value{ text-align:center; font-weight:800; font-size:1.1rem; margin:2px 0 6px; color:#0d3b19; }
.asig .card--summary .rowbar .lbl{ color:#2e7d32; }

/* ===== Menú de acciones pequeño ===== */
.asig-menu{
  position:fixed; inset:0; display:none; z-index:10650;
}
.asig-menu .backdrop{
  position:absolute; inset:0; background:rgba(0,0,0,.25);
}
.asig-menu .sheet{
  position:absolute; left:50%; top:50%;
  transform:translate(-50%,-50%);
  width:90%; max-width:360px;
  background:#fff; border:1px solid var(--border); border-radius:12px;
  box-shadow:0 18px 60px rgba(0,0,0,.25);
}
.asig-menu header{
  padding:10px 14px; border-bottom:1px solid var(--border);
  font-weight:700; color:var(--primary);
}
.asig-menu .body{ padding:10px 10px 6px; }
.asig-menu .body button{
  width:100%; text-align:left; padding:10px 12px; margin:6px 0;
  border:1px solid var(--border); background:#fff; border-radius:10px; cursor:pointer;
}
.asig-menu .body button:hover{ background:#f6fbfa }

/* ===== Prompt de contraseña simple ===== */
.asig-pass{
  position:fixed; inset:0; display:none; z-index:10660;
}
.asig-pass .backdrop{ position:absolute; inset:0; background:rgba(0,0,0,.25); }
.asig-pass .sheet{
  position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
  width:90%; max-width:360px; background:#fff; border:1px solid var(--border);
  border-radius:12px; box-shadow:0 18px 60px rgba(0,0,0,.25);
  padding:12px 14px;
}
.asig-pass h4{ margin:0 0 8px; color:var(--primary) }
.asig-pass .row{ display:flex; gap:8px; align-items:center; }
.asig-pass input{
  flex:1; border:1px solid var(--border); border-radius:8px;
  padding:8px 10px; font-size:.95rem;
}
.asig-pass .actions{ display:flex; gap:8px; justify-content:flex-end; margin-top:10px; }
.asig-pass .actions button{
  padding:8px 12px; border-radius:8px; border:1px solid var(--border); background:#fff; cursor:pointer;
}
.asig-pass .actions .ok{ background:var(--primary); color:#fff; border-color:transparent }
.asig-pass .actions .ok:hover{ filter:brightness(.98) }

/* ===== Pastilla del mes con progreso (Asig/Req) ===== */
.asig .card--mock .month-pill{
  position:relative;
  overflow:hidden;
}
.asig .card--mock .month-pill .pill-fill{
  position:absolute; inset:0 auto 0 0;
  height:100%;
  width:0%;                  /* se setea por JS inline */
  background:#2e7d32;        /* verde progreso */
  opacity:.16;               /* sutil para que siempre se lea el texto */
  border-right:1px solid rgba(46,125,50,.25);
  transition:width .25s ease;
}
.asig .card--mock .month-pill span{
  position:relative;
  z-index:1;
}

/* ===== Popover anclado a la tarjeta ===== */
.asig-pop{
  position:absolute; z-index:10620; display:none;
  width:min(560px, 92vw);
  background:#fff; border:1px solid var(--border); border-radius:12px;
  box-shadow:0 16px 40px rgba(0,0,0,.22);
}
.asig-pop header{
  padding:10px 12px; border-bottom:1px solid var(--border);
  display:flex; align-items:center; justify-content:space-between;
  font-weight:700; color:var(--primary);
}
.asig-pop .x{
  border:1px solid var(--border); background:#fff; border-radius:8px; padding:2px 8px; cursor:pointer;
}
.asig-pop .x:hover{ filter:brightness(.96) }
.asig-pop .body{ max-height:54vh; overflow:auto; padding:8px 12px }

/* flechita opcional */
.asig-pop::after{
  content:""; position:absolute; top:-8px; left:24px;
  border-left:8px solid transparent; border-right:8px solid transparent;
  border-bottom:8px solid #fff; filter:drop-shadow(0 -1px 0 var(--border));
}

/* tabla interna del popover */
.asig-pop table{ width:100%; border-collapse:collapse }
.asig-pop th, .asig-pop td{ padding:8px; border-bottom:1px solid #eef1f3; text-align:left }
.asig-pop th{ background:#f7faf9; font-weight:800; color:#0f1e1d; font-size:.86rem }

/* ===== Menú contextual anclado a la tarjeta ===== */
.asig-card-menu{
  position:absolute;
  z-index:10610;          /* sobre máscara/modales */
  display:none;
  background:#fff;
  border:1px solid var(--border);
  border-radius:10px;
  box-shadow:0 16px 40px rgba(0,0,0,.22);
  padding:6px;
  min-width:220px;
}
.asig-card-menu button{
  width:100%;
  text-align:left;
  padding:10px 12px;
  margin:6px 0;
  border:1px solid var(--border);
  background:#fff;
  border-radius:8px;
  cursor:pointer;
  font-size:.9rem;
}
.asig-card-menu button:hover{ background:#f6fbfa }

:root{
  --ok:#2e7d32;
  --danger:#ef5350;
  --muted-pill:#9aa3af;
}

/* Pastilla MES con gradiente por % asignado */
.asig .card--mock .month-pill{
  position:relative;
  color:#fff;
  border-radius:8px;
  font-weight:700;
  text-align:center;
  padding:6px 8px;
  font-size:.72rem;
  margin-bottom:6px;
  /* usa --asg (0–100) seteado por JS */
  background: linear-gradient(
    90deg,
    var(--ok) 0 calc(var(--asg,0)*1%),
    var(--danger) calc(var(--asg,0)*1%) 100%
  );
}

/* Estados especiales */
.asig .card--mock.full   .month-pill{ background: var(--ok) !important; }
.asig .card--mock.zero   .month-pill{ background: var(--muted-pill) !important; }
.asig .card--mock.need   .month-pill{ /* ya usa el gradiente por defecto */ }

/* (opcional) bordes neutrales, sin “gritar” */
.asig .card--mock{ border:1px solid #4caf50; }
.asig .card--mock.full{ box-shadow:0 0 0 2px rgba(46,125,50,.10); }
.asig .card--mock.need{ box-shadow:0 0 0 2px rgba(239,83,80,.10); }
