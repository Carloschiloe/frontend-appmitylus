<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Directorio de Centros Mit√≠lidos ‚Äî v2</title>

  <!-- Materialize / Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"/>

  <!-- DataTables -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css"/>
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css"/>
  <link rel="stylesheet" href="https://cdn.datatables.net/colreorder/1.7.0/css/colReorder.dataTables.min.css"/>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.fullscreen@2.4.0/Control.FullScreen.css" />

  <!-- App CSS -->
  <link rel="stylesheet" href="/css/centros.rev.css" />
</head>
<body class="cyan lighten-5">
  <!-- Topbar -->
  <nav class="white z-depth-0 topbar">
    <div class="nav-wrapper container">
      <a href="/index.html" class="btn-flat btn-back" title="Volver" aria-label="Volver">
        <i class="material-icons">arrow_back</i>
      </a>
      <span class="brand-logo center teal-text text-darken-3">Directorio de Centros Mit√≠lidos</span>
      <span class="right chips-kpi hide-on-small-only" id="kpiChips"></span>
    </div>
  </nav>

  <main class="container" style="margin-top:16px">
    <!-- Tabs -->
    <ul id="tabs" class="tabs tabs-fixed-width">
      <li class="tab"><a class="active" href="#tab-centros">Directorio</a></li>
      <li class="tab"><a href="#tab-mapa">Mapa</a></li>
    </ul>

    <!-- Directorio -->
    <section id="tab-centros" class="section">
      <div class="card white">
        <div class="card-content">
          <div class="row" style="margin-bottom: 0">
            <div class="col s12 m6">
              <span class="card-title">Centros Registrados</span>
            </div>
            <div class="col s12 m6 right-align">
              <a id="btnOpenCentroModal" class="btn waves-effect teal">
                <i class="material-icons left">add</i>Nuevo centro
              </a>
              <a id="btnOpenImportarModal" class="btn waves-effect orange darken-2">
                <i class="material-icons left">file_upload</i>Importar
              </a>
            </div>
          </div>
          <table id="centrosTable" class="striped display compact nowrap" style="width:100%">
            <thead>
              <tr>
                <th>Proveedor</th>
                <th>Comuna</th>
                <th>C√≥digo</th>
                <th>Hect√°reas</th>
                <th>L√≠neas</th>
                <th>Tons</th>
                <th>Un/Kg</th>
                <th>% Rechazo</th>
                <th>Rdmto</th>
                <th>Detalle</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tfoot>
              <tr>
                <th colspan="3" class="right-align">Totales:</th>
                <th id="totalHect">0.00</th>
                <th id="totalLineas">0</th>
                <th id="totalTons">0</th>
                <th id="totalUnKg">0</th>
                <th id="totalRechazo">0%</th>
                <th id="totalRdmto">0%</th>
                <th colspan="2"></th>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
    </section>

    <!-- Mapa -->
    <section id="tab-mapa" class="section">
      <div class="card white">
        <div class="card-content">
          <div class="row" style="margin-bottom: 6px">
            <div class="col s12 m8"><span class="card-title">Mapa de Centros</span></div>
            <div class="col s12 m4 right-align">
              <a id="btnFullscreenMapa" class="btn btn-small teal"><i class="material-icons left">fullscreen</i>Pantalla completa</a>
            </div>
          </div>
          <div id="mapShell" class="map-shell">
            <aside id="sidebarCentros" class="sidebar">
              <div class="sidebar-head">
                <button id="toggleSidebar" class="btn-flat btn-small" aria-label="Colapsar/expandir"><i class="material-icons">chevron_left</i></button>
                <input id="filtroSidebar" type="text" placeholder="üîç Buscar comuna o proveedor‚Ä¶" aria-label="Buscar" />
              </div>
              <ul id="listaCentrosSidebar" class="sidebar-list"></ul>
            </aside>
            <div id="map" class="map"></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Modales m√≠nimos -->
  <div id="centroModal" class="modal">
    <div class="modal-content"><h5 id="formTitle">Agregar Centro</h5><p>Formulario en desarrollo.</p></div>
    <div class="modal-footer"><a class="modal-close btn-flat">Cerrar</a></div>
  </div>
  <div id="modalImportarCentros" class="modal">
    <div class="modal-content"><h5>Importar desde Excel/CSV</h5><p>Arrastra tu archivo aqu√≠ (pendiente).</p></div>
    <div class="modal-footer"><a class="modal-close btn-flat">Cerrar</a></div>
  </div>

  <!-- Vendor JS -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/colreorder/1.7.0/js/dataTables.colReorder.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.fullscreen@2.4.0/Control.FullScreen.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <!-- App JS -->
  <script>
    window.API_URL = window.API_URL || '/api';
  </script>
  <!-- OJO: la ruta correcta (carpeta /js/centros/) -->
  <script type="module" src="/js/centros/centros.page.js"></script>
</body>
</html>
