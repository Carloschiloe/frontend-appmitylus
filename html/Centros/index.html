<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Directorio de Centros Mit√≠lidos</title>

  <!-- CSS de terceros -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.fullscreen@2.4.0/Control.FullScreen.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css"/>
  <link rel="stylesheet" href="https://cdn.datatables.net/colreorder/1.5.6/css/colReorder.dataTables.min.css"/>
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.3.6/css/buttons.dataTables.min.css"/>

  <!-- Tus estilos (rutas absolutas) -->
  <link rel="stylesheet" href="/styles.css" />
  <link rel="stylesheet" href="/css/centros.css" />

  <!-- Config + utils -->
  <script>window.DEBUG = true;</script>
  <script src="/js/config.js"></script>
  <script src="/js/utils.js"></script>
</head>
<body>
  <!-- NAV -->
  <nav class="teal">
    <div class="nav-wrapper">
      <a href="/index.html" class="btn-flat left" title="Volver" aria-label="Volver">
        <i class="material-icons">arrow_back</i>
      </a>
      <a href="#" class="brand-logo center">Directorio de Centros Mit√≠lidos</a>
    </div>
  </nav>

  <!-- CONTENIDO -->
  <div class="container" style="margin-top: 1rem;">
    <!-- Pesta√±as -->
    <ul id="tabs" class="tabs">
      <li class="tab col s6"><a class="active" href="#tab-centros">Directorio</a></li>
      <li class="tab col s6"><a href="#tab-mapa">Mapa</a></li>
    </ul>

    <!-- TAB CENTROS -->
    <section id="tab-centros" class="col s12">
      <div class="row">
        <div class="col s12">
          <h5>Centros Registrados</h5>
          <table id="centrosTable" class="striped display responsive-table" style="width:100%" aria-describedby="tablaCentrosDescripcion" role="grid" aria-live="polite">
            <caption id="tablaCentrosDescripcion" class="sr-only">Tabla con centros registrados</caption>
            <thead>
              <tr>
                <th style="min-width:130px;">Proveedor</th>
                <th style="min-width:105px;">Comuna</th>
                <th style="min-width:70px;">C√≥digo</th>
                <th style="min-width:60px; max-width:80px;">Hect√°reas</th>
                <th style="width:54px;">L√≠neas</th>
                <th style="width:60px;">Tons</th>
                <th style="width:54px;">Un/Kg</th>
                <th style="width:70px;">% Rechazo</th>
                <th style="width:56px;">Rdmto</th>
                <th style="width:48px;">Detalle</th>
                <th style="width:72px;">Acciones</th>
              </tr>
            </thead>
            <tfoot>
              <tr>
                <th colspan="3" style="text-align:right">Totales:</th>
                <th id="totalHect">0.00</th>
                <th id="totalLineas">0</th>
                <th id="totalTons">0</th>
                <th id="totalUnKg">0</th>
                <th id="totalRechazo">0</th>
                <th id="totalRdmto">0</th>
                <th colspan="2"></th>
              </tr>
            </tfoot>
          </table>
          <div id="acordeonLineas"></div>
        </div>
      </div>
    </section>

    <!-- TAB MAPA -->
    <section id="tab-mapa" class="col s12">
      <h5 class="map-title">Mapa de Centros</h5>

      <!-- Contenedor mapa + sidebar -->
      <section id="mapShell" tabindex="0" aria-label="Mapa interactivo de centros">
        <!-- Overlay de b√∫squeda -->
        <div id="mapSearchOverlay" class="map-search">
          <form id="mapSearchForm" autocomplete="off">
            <input id="mapSearchInput" type="search"
                   placeholder="Buscar por C√≥digo, Titular o C√≥digo de √Årea‚Ä¶"
                   aria-label="Buscar centro" />
          </form>
          <ul id="mapSearchResults" class="map-search-results" role="listbox"></ul>
        </div>

        <!-- Sidebar mini -->
        <aside id="sidebarCentros" class="sidebar-centros">
          <button id="toggleSidebar" class="toggle-btn" aria-label="Colapsar/Expandir Sidebar">
            <span id="toggleSidebarIcon" class="material-icons">chevron_left</span>
          </button>
          <input id="filtroSidebar" type="text" placeholder="üîç Buscar comuna o proveedor‚Ä¶" aria-label="Buscar comuna o proveedor" autocomplete="off" />
          <ul id="listaCentrosSidebar" class="sidebar-list"></ul>
        </aside>

        <!-- Mapa (altura se maneja por CSS) -->
        <div id="map"></div>
      </section>
    </section>

    <!-- MODALES (contenido como ya lo tienes) -->
    <div id="centroModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="formTitle" tabindex="-1"></div>
    <div id="modalDetallesCentro" class="modal" role="dialog" aria-modal="true" aria-labelledby="detallesCentroTitle" tabindex="-1">
      <div class="modal-content">
        <h5 id="detallesCentroTitle">Detalles del Centro</h5>
        <div id="detallesCentroBody"></div>
      </div>
      <div class="modal-footer">
        <button class="modal-close btn grey lighten-1" aria-label="Cerrar modal">Cerrar</button>
      </div>
    </div>
    <div id="modalCoordenadas" class="modal" role="dialog" aria-modal="true" aria-labelledby="coordenadasTitle" tabindex="-1"></div>
    <div id="modalImportarCentros" class="modal" tabindex="-1"></div>
  </div>

  <!-- FABs -->
  <div style="position: fixed; bottom: 34px; right: 30px; z-index: 1030; display: flex; flex-direction: column; gap: 16px;">
    <a id="btnOpenCentroModal" class="btn-floating btn-large teal tooltipped" data-tooltip="Agregar Centro" aria-label="Agregar Centro">
      <i class="material-icons">add</i>
    </a>
    <a id="btnOpenImportarModal" class="btn-floating btn-large orange darken-2 tooltipped" data-tooltip="Importar desde Excel/CSV" aria-label="Importar Centros">
      <i class="material-icons">file_upload</i>
    </a>
  </div>

  <!-- JS de terceros -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/colreorder/1.5.6/js/colReorder.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.fullscreen@2.4.0/Control.FullScreen.js"></script>

  <!-- XLSX pinneado -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <!-- Tu bundle principal -->
  <script type="module" src="/js/app.js"></script>

  <!-- Inicializaci√≥n Materialize -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      M.Modal.init(document.querySelectorAll('.modal'));
      M.Tooltip.init(document.querySelectorAll('.tooltipped'));
      const tabsEl = document.getElementById('tabs');
      if (tabsEl) M.Tabs.init(tabsEl);

      document.getElementById('btnOpenImportarModal')
        ?.addEventListener('click', () =>
          M.Modal.getInstance(document.getElementById('modalImportarCentros')).open()
        );
      document.getElementById('btnOpenCentroModal')
        ?.addEventListener('click', () =>
          M.Modal.getInstance(document.getElementById('centroModal')).open()
        );
    });
  </script>

  <noscript>Esta p√°gina requiere JavaScript habilitado.</noscript>
</body>
</html>
