<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Planificación Producción · Abastecimiento</title>

  <!-- Materialize & Google Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>

  <!-- DataTables + Buttons -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css">

  <!-- Global styles (si ya lo usas) -->
  <link rel="stylesheet" href="/styles.css" />
  <link rel="stylesheet" href="/css/abastecimiento.css" />
</head>
<body class="grey lighten-5">
  <!-- NAV -->
  <nav class="teal">
    <div class="nav-wrapper container">
      <a href="../categorias.html" class="btn-flat left" title="Volver" aria-label="Volver">
        <i class="material-icons" aria-hidden="true">arrow_back</i>
      </a>
      <a class="brand-logo center">Planificación de Producción</a>
    </div>
  </nav>

  <main role="main" class="container page-wrap">
    <!-- KPIs -->
    <section class="kpi-grid" aria-label="Indicadores principales">
      <div class="kpi card">
        <h6>Meta (t) período</h6>
        <div class="val" id="kpi_meta">—</div>
        <div class="sub">Escala según vista</div>
      </div>
      <div class="kpi card">
        <h6>Planificado (t)</h6>
        <div class="val" id="kpi_plan">—</div>
        <div class="sub">Bloques agendados</div>
      </div>
      <div class="kpi card">
        <h6>Confirmado (t)</h6>
        <div class="val" id="kpi_confirmado">—</div>
        <div class="sub">Compromiso proveedor</div>
      </div>
      <div class="kpi card">
        <h6>Cumplimiento</h6>
        <div class="val" id="kpi_cumplimiento">—%</div>
        <div class="progress slim"><div id="kpi_bar" class="determinate" style="width:0%"></div></div>
      </div>
      <!-- KPIs opcionales -->
      <div class="kpi card kpi--optional">
        <h6>Requerida (t)</h6>
        <div class="val" id="kpi_requerida">—</div>
        <div class="sub">Demanda del período</div>
      </div>
      <div class="kpi card kpi--optional">
        <h6>Abastecida (t)</h6>
        <div class="val" id="kpi_abastecida">—</div>
        <div class="sub">Real entregado</div>
      </div>
    </section>

    <!-- Toolbar / Filtros -->
    <section class="card-panel toolbar-panel" aria-label="Filtros">
      <div class="toolbar">
        <!-- Vista -->
        <div class="input-field w3">
          <select id="f_vista" class="browser-default" aria-label="Vista">
            <option value="semana" selected>Semana</option>
            <option value="mes">Mes</option>
            <option value="anio">Año</option>
          </select>
          <label class="active static-label" for="f_vista">Vista</label>
        </div>

        <!-- Periodo -->
        <div class="w5 periodo-wrap">
          <div class="periodo-nav">
            <a id="btnPrevPeriodo" class="btn-flat btn-ghost" aria-label="Periodo anterior" title="Anterior"><i class="material-icons" aria-hidden="true">chevron_left</i></a>
          </div>

          <div class="input-field" id="wrap_semana">
            <input type="week" id="f_semana" max="2027-W52" aria-label="Semana">
            <label class="active" for="f_semana">Semana</label>
          </div>

          <div class="input-field hidden" id="wrap_mes">
            <input type="month" id="f_mes" max="2027-12" aria-label="Mes">
            <label class="active" for="f_mes">Mes</label>
          </div>

          <div class="input-field hidden" id="wrap_anio">
            <input type="number" id="f_anio" min="2020" max="2027" step="1" placeholder="YYYY" aria-label="Año">
            <label class="active" for="f_anio">Año</label>
          </div>

          <div class="periodo-nav">
            <a id="btnNextPeriodo" class="btn-flat btn-ghost" aria-label="Periodo siguiente" title="Siguiente"><i class="material-icons" aria-hidden="true">chevron_right</i></a>
          </div>
        </div>

        <!-- Escenario -->
        <div class="input-field w3">
          <select id="f_escenario" class="browser-default" aria-label="Escenario">
            <option value="base" selected>Base</option>
            <option value="optimista">Optimista</option>
            <option value="conservador">Conservador</option>
          </select>
          <label class="active static-label" for="f_escenario">Escenario</label>
        </div>

        <!-- Búsqueda + toggles -->
        <div class="input-field w4">
          <input id="f_buscar" type="text" placeholder="Buscar proveedor o centro…" aria-label="Buscar proveedor o centro">
          <label for="f_buscar" class="active">Búsqueda</label>
        </div>
        <div class="w6 toggles">
          <label>
            <input type="checkbox" id="f_soloConfirmado" class="filled-in" />
            <span>Sólo confirmados</span>
          </label>
          <label>
            <input type="checkbox" id="f_ocultarCancelados" class="filled-in" checked/>
            <span>Ocultar cancelados</span>
          </label>
        </div>

        <!-- Acciones -->
        <div class="actions">
          <a id="btnAsignarMMPP" class="btn teal"><i class="material-icons left" aria-hidden="true">add_circle</i>Asignar MMPP</a>
          <a id="btnHoy" class="btn-flat waves-effect">Hoy</a>
          <a id="btnReset" class="btn-flat waves-effect">Limpiar</a>
          <a id="btnImportarContactos" class="btn-flat waves-effect">Importar contactos</a>
          <a id="btnXls" class="btn-flat waves-effect">Excel</a>
          <a id="btnPdf" class="btn-flat waves-effect">PDF</a>
        </div>
      </div>
    </section>

    <!-- Pestañas -->
    <ul class="tabs">
      <li class="tab col s3"><a class="active" href="#tab-semanal">Programa</a></li>
      <li class="tab col s3"><a href="#tab-tablero">Tablero</a></li>
      <li class="tab col s3"><a href="#tab-mensual">Plan mensual</a></li>
      <li class="tab col s3"><a href="#tab-parametros">Parámetros</a></li>
    </ul>

    <!-- TAB: Programa -->
    <section id="tab-semanal" class="mt-12" aria-label="Programa semanal">
      <table id="tablaProgramaSemanal" class="highlight display" style="width:100%">
        <caption class="grey-text">Programa del período activo</caption>
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Proveedor</th>
            <th>Centro</th>
            <th>Tons</th>
            <th>Estado</th>
            <th>Prioridad</th>
            <th>Origen</th>
            <th>Notas</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- TAB: Tablero (gráficos) -->
    <section id="tab-tablero" class="mt-18" aria-label="Tablero de control">
      <div class="row">
        <div class="col s12 l6">
          <div class="chart-card card">
            <h6 class="chart-title">Avance vs Meta (t)</h6>
            <canvas id="ch_meta" aria-label="Gráfico Avance vs Meta"></canvas>
          </div>
        </div>
        <div class="col s12 l6">
          <div class="chart-card card">
            <h6 id="lbl_ch_dias" class="chart-title">Tons por día (semana)</h6>
            <canvas id="ch_dias" aria-label="Gráfico Tons por día"></canvas>
          </div>
        </div>
        <div class="col s12 l6 mt-14">
          <div class="chart-card card">
            <h6 class="chart-title">Desglose por estado</h6>
            <canvas id="ch_estados" aria-label="Gráfico por estado"></canvas>
          </div>
        </div>
        <div class="col s12 l6 mt-14">
          <div class="chart-card card">
            <h6 class="chart-title">Requerida vs Programada vs Abastecida (t)</h6>
            <canvas id="ch_rpa" aria-label="Gráfico R-P-A"></canvas>
          </div>
        </div>
        <div class="col s12 l6 mt-14">
          <div class="chart-card card">
            <h6 class="chart-title">% Abastecida en tiempo real vs Requerida</h6>
            <div class="progress slim"><div id="rt_bar" class="determinate" style="width:0%"></div></div>
            <div id="rt_label" class="sub">0% (0/0 t)</div>
          </div>
        </div>
        <div class="col s12 l6 mt-14">
          <div class="chart-card card">
            <h6 class="chart-title">Últimos 5 abastecimientos vs requerido</h6>
            <ul id="rt_list" class="rt-list"></ul>
          </div>
        </div>
      </div>
    </section>

    <!-- TAB: Mensual -->
    <section id="tab-mensual" class="mt-18" aria-label="Plan mensual">
      <div class="card-panel">
        <h6 class="section-title">Resumen por semana (mes)</h6>
        <table id="tablaMensual" class="striped">
          <caption class="grey-text">Resumen de meta, plan y confirmado por semana</caption>
          <thead>
            <tr>
              <th>Semana</th>
              <th>Meta (t)</th>
              <th>Plan (t)</th>
              <th>Confirmado (t)</th>
              <th>Gap (t)</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="card mt-14">
        <h6 class="section-title">Gantt mensual (meta vs plan vs real)</h6>
        <div id="ganttMes" class="gantt" aria-label="Gantt mensual"></div>
        <small class="grey-text">* Ancho de barra = % de meta semanal. Colores: meta (contorno), plan (azul), real (verde).</small>
      </div>
    </section>

    <!-- TAB: Parámetros -->
    <section id="tab-parametros" class="mt-18" aria-label="Parámetros del plan">
      <div class="card-panel">
        <h6 class="section-title">Parámetros del plan</h6>
        <div class="row">
          <div class="input-field col s12 m4">
            <input type="number" id="p_objetivo" min="0" step="10" value="400">
            <label for="p_objetivo">Objetivo semana (t)</label>
          </div>
          <div class="input-field col s12 m4">
            <input type="number" id="p_lead" min="0" step="1" value="7">
            <label for="p_lead">Lead time (días)</label>
          </div>
          <div class="input-field col s12 m4">
            <input type="number" id="p_buffer" min="0" step="1" value="2">
            <label for="p_buffer">Buffer logístico (días)</label>
          </div>
        </div>
        <a class="btn teal" id="btnGuardarParametros"><i class="material-icons left" aria-hidden="true">save</i>Guardar</a>
      </div>
    </section>
  </main>

  <!-- MODAL: Asignar MMPP -->
  <div id="modalBloque" class="modal" aria-hidden="true" aria-label="Asignar MMPP">
    <div class="modal-content">
      <h5>Asignar MMPP</h5>
      <form id="formBloque" autocomplete="off">
        <div class="row">
          <div class="input-field col s12 m4">
            <input type="date" id="b_fecha" required>
            <label class="active" for="b_fecha">Fecha</label>
          </div>
          <div class="input-field col s12 m4">
            <input id="b_proveedor" type="text" list="dl_proveedores" placeholder="Proveedor" required>
            <label for="b_proveedor">Proveedor</label>
            <datalist id="dl_proveedores"></datalist>
          </div>
          <div class="input-field col s12 m4">
            <select id="b_centro" class="browser-default">
              <option value="">Centro (opcional)</option>
            </select>
            <label class="active static-label" for="b_centro">Centro</label>
          </div>
        </div>

        <div class="row">
          <div class="input-field col s12 m4">
            <input type="number" id="b_tons" min="0.01" step="0.01" placeholder="Ej: 120" required inputmode="decimal">
            <label for="b_tons">Toneladas MMPP</label>
          </div>
          <div class="input-field col s12 m4">
            <select id="b_estado" class="browser-default">
              <option value="Planificado" selected>Planificado</option>
              <option value="Confirmado">Confirmado</option>
              <option value="Cancelado">Cancelado</option>
            </select>
            <label class="active static-label" for="b_estado">Estado</label>
          </div>
          <div class="input-field col s12 m4">
            <select id="b_prioridad" class="browser-default">
              <option>Alta</option><option selected>Media</option><option>Baja</option>
            </select>
            <label class="active static-label" for="b_prioridad">Prioridad</label>
          </div>
        </div>

        <div class="input-field">
          <textarea id="b_notas" class="materialize-textarea" placeholder="Observaciones"></textarea>
          <label for="b_notas">Notas</label>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <a class="modal-close btn-flat">Cancelar</a>
      <button class="btn teal" type="submit" form="formBloque"><i class="material-icons left" aria-hidden="true">save</i>Guardar</button>
    </div>
  </div>

  <!-- Scripts base -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <!-- Lógica -->
  <script type="module" src="/js/abastecimiento/planificacion/index.js"></script>
</body>
</html>



