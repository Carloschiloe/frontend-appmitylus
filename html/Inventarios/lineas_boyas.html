<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Inventario Líneas &amp; Boyas</title>

  <!-- Materialize CSS -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
  />
  <link
    href="https://fonts.googleapis.com/icon?family=Material+Icons"
    rel="stylesheet"
  />

  <!-- DataTables CSS -->
  <link
    rel="stylesheet"
    href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css"
  />
  <link
    rel="stylesheet"
    href="https://cdn.datatables.net/buttons/2.3.6/css/buttons.dataTables.min.css"
  />

  <!-- Choices.js CSS -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css"
  />

  <!-- Tus estilos -->
  <link rel="stylesheet" href="../../css/lineas_boyas.css"/>
</head>
<body class="grey lighten-4">
  <nav class="teal darken-2">
    <div class="nav-wrapper">
      <a href="./index.html" class="btn-flat left" style="margin-left:8px">
        <i class="material-icons">arrow_back</i>
      </a>
      <span class="brand-logo center">Líneas &amp; Boyas</span>
    </div>
  </nav>

  <div class="container" style="margin-top:16px;">
    <!-- Tabs internas -->
    <ul id="tabsLB" class="tabs">
      <li class="tab col s4"><a class="active" href="#tab-conteo">Conteo</a></li>
      <li class="tab col s4"><a href="#tab-ultimos">Últimos / Resumen</a></li>
      <li class="tab col s4"><a href="#tab-historial">Historial</a></li>
    </ul>

    <!-- TAB Conteo -->
    <div id="tab-conteo" style="padding-top:20px;">
      <div class="row">
        <div class="input-field col s12 m6">
          <select id="inputCentro" placeholder="Selecciona un centro"></select>
          <label>Centro</label>
        </div>
        <div class="input-field col s12 m6">
          <select id="inputLinea" disabled placeholder="Selecciona una línea"></select>
          <label>Línea</label>
        </div>
      </div>

      <div id="resumenInventario" class="card-panel grey lighten-3" style="display:none"></div>

      <div class="fixed-action-btn">
        <a
          id="btnAbrirConteo"
          class="btn-floating btn-large red tooltipped"
          data-tooltip="Conteo rápido"
        >
          <i class="material-icons">add</i>
        </a>
      </div>
    </div>

    <!-- TAB Últimos / Resumen -->
    <div id="tab-ultimos" style="padding-top:20px;">
      <div id="kpiGroups"></div>
      <div id="kpiSmallGroup"></div>
      <div id="fEstadoLineaDiv" class="input-field">
        <select id="fEstadoLinea">
          <option value="all" selected>Estado (todas)</option>
          <option value="buena">Buenas</option>
          <option value="regular">Regulares</option>
          <option value="mala">Malas</option>
          <option value="sinInv">Sin inventario</option>
        </select>
        <label>Filtrar por estado de línea</label>
      </div>
      <table id="tablaUltimos" class="striped display nowrap" style="width:100%">
        <thead>
          <tr>
            <th>Centro</th><th>Línea</th><th>Fecha</th><th>Tot</th>
            <th>NB Buenas</th><th>NB Malas</th><th>NA Buenas</th><th>NA Malas</th>
            <th>Sueltas</th><th>Colchas</th><th>Estado Línea</th><th>Obs</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- TAB Historial -->
    <div id="tab-historial" style="padding-top:20px;">
      <table id="tablaInventariosLB" class="striped display nowrap" style="width:100%">
        <thead>
          <tr>
            <th>Fecha</th><th>Centro</th><th>Línea</th><th>Tot</th>
            <th>NB Buenas</th><th>NB Malas</th><th>NA Buenas</th><th>NA Malas</th>
            <th>Sueltas</th><th>Colchas</th><th>Estado Línea</th><th>Obs</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- Modal Conteo Rápido (igual al tuyo) -->
  <div id="conteoLineaModal" class="modal">
    <div class="modal-content">
      <h5 id="conteoTitulo">Conteo rápido</h5>
      <div id="conteoDisplay" style="font-size:2rem; margin:1rem 0">#0</div>
      <div id="statsLine" style="margin-bottom:1rem">
        Tot: 0 | NB:0/0 NA:0/0 | S:0 | Col:0
      </div>
      <!-- Tu Collapsible y campos aquí… -->
    </div>
    <div class="modal-footer">
      <a id="btnUndoEvento" href="#!" class="btn-flat">Deshacer</a>
      <a id="btnGuardarConteo" href="#!" class="btn">Guardar</a>
      <a href="#!" class="modal-close btn-flat">Cancelar</a>
    </div>
  </div>

  <!-- 1) jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- 2) Materialize JS -->
  <script>
    const _d = window.define, _a = _d && _d.amd;
    if (_d && _a) delete window.define;
    const s2 = document.createElement('script');
    s2.src = 'https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js';
    s2.onload = () => {
      // Inicializamos solo lo necesario
      M.Tabs.init(document.querySelectorAll('.tabs'));
      M.Tooltip.init(document.querySelectorAll('.tooltipped'));
      M.Collapsible.init(document.querySelectorAll('.collapsible'));
      M.Modal.init(document.querySelectorAll('.modal'));
      M.FormSelect.init(document.querySelectorAll('#conteoEstadoLinea'));
      if (_d) window.define = _d;
      if (_a) window.define.amd = _a;
    };
    document.head.appendChild(s2);
  </script>

  <!-- 3) Choices.js -->
  <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

  <!-- 4) DataTables & plugins -->
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.print.min.js"></script>

  <!-- 5) Módulos ES -->
  <script type="module" src="../../js/inventarios/lineas_boyas/app_lineas.js"></script>
  <script type="module" src="../../js/inventarios/lineas_boyas/conteo_rapido.js"></script>
</body>
</html>
